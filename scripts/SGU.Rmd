---
title: "SGU 2018 Science or Fiction Stats"
author: "Wayne Heller"
date: "January 26, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.width = 18, fig.height = 14)
```

``` {r loaddata, echo=FALSE}
library(readxl)
library(dplyr)
library(reshape2)
library(knitr)
library(scales)
library(ggplot2)
library(gridExtra)
library(forcats)

debug_flag = FALSE # See description below.  If TRUE, will show the summarization values from spreadsheet as a validation
Episode_range = 652:703
Episode_range_LY = 652:703
Current_Year = 2018
Last_Year = 2017
XL_SHEET_2017_SUMMARY = 4
XL_SHEET_2018_SUMMARY = 5
```

## Background
The Skeptics Guide to the Universe is a weekly podcast hosted by Dr. Steven Novella.  Each week during this segment of the podcast, Dr. Novella presents his panel of skeptics with 3 or 4 science-related news items, 1 of which is fiction.  And each panelist must determine which is the fiction.

## Year End Episode
At the end of the calendar year, Dr. Novella host a year in review episode where the panel reviews their performance at Science or Fiction.  

## `r Current_Year` Summary - Episodes# `r Episode_range[1]` - `r tail(Episode_range,1)`

* Evan led this year with the highest overall win percentage, followed by Jay 
* The Rogues performed better overall this year compared to last 60.7% to 55.6%
* Cara is the only rogue that performs better on segments with themes than without. 
* Evan has the most solo wins, followed by Cara and Jay.
* The panel performs better overall when Cara answers first 
* Relative to other panelists, Bob does well when he is the first to answer.  Performance for all rogues answering first dramatically improved this year compared to last year.
* There were 12 panelist sweeps (compared to 7 in 2017) and 4 hosts sweeps, 1 by Bob, 1 by Jay and 2 by Steve (Steve had 5 host sweeps last year and Evan had 1).    

## `r Current_Year` Summary Statistics 
 

``` {r readstats, echo = FALSE}
# This code has evolved over time, in the first iteration, markdown was simply used to read summary values from the source data
# in Excel and present it on an HTML page published to RPubs.com.  In the next version, the Excel file was modified to put the
# panelist answers on a separate tab in tidy format.  The revised markdown reads the data and does the summarization.  Since
# both versions exist in the same Excel file, this code is able to create a markdown file that shows both, the summary from Excel
# and the calculated summarizations.  Setting the debug_flag to TRUE enables both versions to be shown

pathtofile <- file.path("..",'SGU_Science_or_Fiction.xlsx')
Rogues <- c("Steve", "Bob", "Evan", "Cara", "Jay")



if (TRUE) {
    dfSGUSummary <- readxl::read_excel(pathtofile, sheet = XL_SHEET_2017_SUMMARY )
    dfSGUSummary <- as.data.frame(dfSGUSummary)
    rownames(dfSGUSummary) <- dfSGUSummary$Statistic
    dfSGUSummary <- select(dfSGUSummary, -Statistic)
    
    dfSGUSummary <- select(dfSGUSummary, c(Rogues, "ALL"))
    dfSGUSummary <- t(dfSGUSummary)
}

# Current Year dataframes
dfEpisodeData <- readxl::read_excel(pathtofile, sheet = 1 )
dfEpisodeData <- as.data.frame(dfEpisodeData)
dfEpisodeData <- select(dfEpisodeData, 1:8) %>% filter(Episode %in% Episode_range)
    
    
dfItemsSelected <- readxl::read_excel(pathtofile, sheet =2)
dfItemsSelected <- as.data.frame(dfItemsSelected)
dfItemsSelected <- select(dfItemsSelected, c('Episode', 'Panelist', 'ItemSelected', 'AnsweringOrder'))
dfItemsSelected <- filter(dfItemsSelected, Episode %in% Episode_range)
    

dfFictionItems <- select(dfEpisodeData, c('Episode', 'FictionItem', 'Theme'))
dfItemsSelected <- inner_join(dfItemsSelected, dfFictionItems, by='Episode')
dfItemsSelected$Correct <- mapply(ifelse, test = (dfItemsSelected$ItemSelected == dfItemsSelected$FictionItem), yes = 1, no = 0 )
dfItemsSelected$Theme <- mapply(ifelse, test = !is.na(dfItemsSelected$Theme), yes = 'With Theme', no = 'Without Theme')
dfPanelistPerf <- dfItemsSelected %>% select(Episode, AnsweringOrder, Correct, Panelist, Theme) %>% filter(Panelist %in% Rogues) 
dfOverallPerf <- dfItemsSelected %>% select(Episode, AnsweringOrder, Correct, Panelist, Theme) # %>% filter(Panelist %in% Rogues)

# Append number correct for each episode
dfCorrect <- as.data.frame(dfItemsSelected %>% group_by(Episode) %>% summarise(CorrectAnswers = sum(Correct)))
dfEpisodeData <- inner_join(dfEpisodeData, dfCorrect, by='Episode')

# Append panelist who answered first for each episode
dfFirstPanelist <- as.data.frame(dfItemsSelected %>% group_by(Episode) %>% filter(AnsweringOrder==1) %>% select(Episode, FirstPanelist = Panelist))
dfEpisodeData <- inner_join(dfEpisodeData, dfFirstPanelist, by='Episode')

# Append number of panelists for each episode
dfTotalPanelists <- as.data.frame(dfItemsSelected %>% group_by(Episode) %>% summarise(TotalPanelists = n()) %>% select(Episode, TotalPanelists))
dfEpisodeData <- inner_join(dfEpisodeData, dfTotalPanelists, by='Episode')

# Prior Year dataframes
dfEpisodeData_LY <- readxl::read_excel(pathtofile, sheet = 1 )
dfEpisodeData_LY <- as.data.frame(dfEpisodeData_LY)
dfEpisodeData_LY <- select(dfEpisodeData_LY, 1:8) %>% filter(Episode %in% Episode_range_LY)

    
dfItemsSelected_LY <- readxl::read_excel(pathtofile, sheet =2)
dfItemsSelected_LY <- as.data.frame(dfItemsSelected_LY)
dfItemsSelected_LY <- select(dfItemsSelected_LY, c('Episode', 'Panelist', 'ItemSelected', 'AnsweringOrder'))
dfItemsSelected_LY <- filter(dfItemsSelected_LY, Episode %in% Episode_range_LY)


dfFictionItems_LY <- select(dfEpisodeData_LY, c('Episode', 'FictionItem', 'Theme'))
dfItemsSelected_LY <- inner_join(dfItemsSelected_LY, dfFictionItems_LY, by='Episode')
dfItemsSelected_LY$Correct <- mapply(ifelse, test = (dfItemsSelected_LY$ItemSelected == dfItemsSelected_LY$FictionItem), yes = 1, no = 0 )
dfItemsSelected_LY$Theme <- mapply(ifelse, test = !is.na(dfItemsSelected_LY$Theme), yes = 'With Theme', no = 'Without Theme')
dfPanelistPerf_LY <- dfItemsSelected_LY %>% select(Episode, AnsweringOrder, Correct, Panelist, Theme) %>% filter(Panelist %in% Rogues) 
dfOverallPerf_LY <- dfItemsSelected_LY %>% select(Episode, AnsweringOrder, Correct, Panelist, Theme) # %>% filter(Panelist %in% Rogues)

# Append number correct for each episode
dfCorrect_LY <- as.data.frame(dfItemsSelected_LY %>% group_by(Episode) %>% summarise(CorrectAnswers = sum(Correct)))
dfEpisodeData_LY <- inner_join(dfEpisodeData_LY, dfCorrect_LY, by='Episode')

# Append panelist who answered first for each episode
dfFirstPanelist_LY <- as.data.frame(dfItemsSelected_LY %>% group_by(Episode) %>% filter(AnsweringOrder==1) %>% select(Episode, FirstPanelist = Panelist))
dfEpisodeData_LY <- inner_join(dfEpisodeData_LY, dfFirstPanelist_LY, by='Episode')

# Append number of panelists for each episode
dfTotalPanelists_LY <- as.data.frame(dfItemsSelected_LY %>% group_by(Episode) %>% summarise(TotalPanelists = n()) %>% select(Episode, TotalPanelists))
dfEpisodeData_LY <- inner_join(dfEpisodeData_LY, dfTotalPanelists_LY, by='Episode')


showStatistic <- function(statName, ispercentage = TRUE) {
    myStat <- dfSGUSummary[, statName]
    myStat <- na.exclude(myStat)
    if (ispercentage) {
        myStat2 <- sprintf("%.1f%%", myStat*100)
    }
    else {
        myStat2 <- sprintf("%.0f", myStat)
    }
    names(myStat2) <- names(myStat)
    
    kable(sort(myStat2, decreasing = TRUE), format.args = list(justify='right', width=500) , rownames=TRUE, col.names=NA, digits=2, align = c('l', 'l'), format='html', table.attr = "style='width:15%;'")

}

showStatistic_2 <- function(lstResults, ispercentage = TRUE) {
    
    kable(lstResults, format.args = list(justify='right', width=500) , rownames=TRUE, col.names=NULL, digits=1, align = c('l', 'l'), format='html', table.attr = "style='width:15%;'")

}

```



``` {r Plots, echo = FALSE}
# Overall Performance
stat1 <- dfPanelistPerf %>% group_by(Panelist) %>% summarise(Overall =  percent(sum(Correct)/n())) 
total1 <- dfOverallPerf %>% summarise(Overall =  percent(sum(Correct)/n())) 
stat1 <- rbind(stat1,c("ALL", total1[1,1])) %>% arrange(desc(Overall))

#p1 <- ggplot(stat1, aes(x=reorder(Panelist, desc(Overall)), y=Overall)) + geom_bar(stat="identity", width=0.5) + ggtitle("Science or Fiction 2018 Results") + theme(text = element_text(size=20)) + ylab('% Wins Overall') + xlab('')

panelistLevels = stat1$Panelist # Preserve order for second graph

stat2 <- dfPanelistPerf %>% group_by(Panelist, Theme) %>% summarise(pctThemes = percent(sum(Correct)/n())) 
total2 <- dfOverallPerf %>% group_by(Theme) %>% summarise(pctThemes = percent(sum(Correct)/n())) %>% mutate(Panelist = 'ALL') %>% select(Panelist, Theme, pctThemes)
stat2 <- as.data.frame(stat2)
total2 <- as.data.frame(total2)
stat2 <- rbind(stat2,total2) 


stat2$Panelist = factor(stat2$Panelist, levels=panelistLevels)


#p2 <- ggplot(stat2, aes(x=Panelist, y=pctThemes, fill=Theme)) + geom_bar(stat="identity", position = position_dodge(width=.75), color="grey40", width=0.75) + ggtitle("Science or Fiction 2018 Results") + theme(legend.position = c(.85,1), legend.justification = c(1,1), legend.background = element_blank(), text = element_text(size=20) ) + ylab('% Wins Themes / No Themes') + xlab('')




summary1 <- stat1 %>% mutate(Result = "% Wins Overall") %>% select(Result, Panelist, Overall) 
names(summary1) <- c("Result", "Panelist", "Pct")
summary1_wide <- dcast(summary1, Result ~ Panelist) %>% select(c('Result', panelistLevels))

summary2 <- stat2 
summary2$Theme <- mapply(ifelse, test = (summary2$Theme == "With Theme"), yes = '% Wins With Themes', no = '% Wins Without Themes')
summary2 <- summary2 %>% select(Theme, Panelist, pctThemes)
names(summary2) <- c("Result", "Panelist", "Pct")
summary2_wide <- dcast(summary2, Result ~ Panelist) %>% select(c('Result', panelistLevels))
summary_final_wide <- rbind(summary1_wide, summary2_wide)

#k <- kable(summary_final, format.args = list(justify='right', width=500) ,row.names=NA, digits=1, format='html', table.attr = "style='width:90%;'")

#tt1 <- ttheme_default()
t <- tableGrob(summary_final_wide, rows=NULL, theme = ttheme_default(core=list(fg_params=list(fontface=3L, fontsize=20), bg_params = list(fill = c("#FFFF00", "#E69F00", "#56B4E9"), col=NA)), colhead=list(fg_params=list(fontface=4L, fontsize=20))) )
t$widths <- unit(rep(1/ncol(t), ncol(t)), "npc")

summary_final <- rbind(summary1, summary2)
summary_final$Panelist = factor(summary_final$Panelist, levels=panelistLevels)
resultLevels = unique(summary_final$Result)
summary_final$Result = factor(summary_final$Result, levels=resultLevels, ordered=TRUE)
summary_final <- as.data.frame(summary_final) 

p_final <- ggplot(summary_final, aes(x=Panelist, y=Pct)) + geom_bar(aes(fill=Result),stat="identity", position = position_dodge(width=.85), color="grey40", width=0.80) + ggtitle("Evan Leads Overall \n Cara Leads on Segments with Themes \n Evan Leads on Segments Without Themes") + 
    theme(legend.position = c(.95,1.03), 
          legend.justification = c(1,1), 
          legend.key.size = unit(2, 'lines'), 
          legend.background = element_blank(), 
          text = element_text(size=25),
          plot.title = element_text(hjust = 0.5)) + 
    ylab('% Wins') + xlab('') + 
    scale_fill_manual(values=c("#FFFF00", "#E69F00", "#56B4E9")) + 
    geom_text(aes(group=Result, label=Pct), vjust=2, position = position_dodge(width=.85), size=6) +
    guides(fill=guide_legend(title=""))

lay <- rbind(c(1), c(1), c(1), c(2))
grid.arrange(grobs=list(p_final, t), layout_matrix=lay)
```

**NOTE: ALL includes contributions from Special Guest Rogues not listed**  
Raw data and some visuals are located in [This Excel file](https://github.com/wayneheller/SGU_Science_or_Fiction/blob/master/SGU_Science_or_Fiction.xlsx) Click the Download button on this github page.  
Last Year comparison is based on Episodes 601 - 651

``` {r winsOverall_debug, echo = FALSE, eval = debug_flag}
Overall Win Percentage  
showStatistic('% Wins Overall')
```

### Overall Performance
``` {r winsOverall, echo = FALSE}
# Much of this code will need to be rewrite for 2019 to pull from the same set of data
statTY <- dfPanelistPerf %>% group_by(Panelist) %>% summarise(Overall =  percent(sum(Correct)/n())) 
totalTY <- dfOverallPerf %>% summarise(Overall =  percent(sum(Correct)/n())) 
statTY <- rbind(statTY,c("ALL", totalTY[1,1])) %>% arrange(desc(Overall))

# All of this code is to pull from the Excel Summary for 2017
statName <- '% Wins Overall'
statLY <- dfSGUSummary[, statName]
statLY <- na.exclude(statLY)
statLY2 <- sprintf("%.1f%%", statLY*100)
names(statLY2) <- names(statLY)
dfstatLY2 <- as.data.frame(statLY2)
dfstatLY2<- cbind(Panelist = rownames(dfstatLY2), dfstatLY2)
rownames(dfstatLY2) <- NULL


statYoY <- merge(statTY, dfstatLY2, by = 'Panelist') 

names(statYoY) <- c('Panelist', Current_Year, Last_Year)

kable(statYoY, format.args = list(justify='right', width=500) , rownames=TRUE,  digits=1, align = c('l', 'c', 'c'), format='html', table.attr = "style='width:25%;'")

#showStatistic_2(stat)
```

### Performance For Segments WITH Themes
``` {r winsThemes_debug, echo = FALSE, eval = debug_flag}

showStatistic('% Wins with Themes')
```

``` {r winsThemes, echo = FALSE}
statTY <- dfPanelistPerf %>% group_by(Panelist) %>% filter(Episode %in% dfEpisodeData[!is.na(dfEpisodeData$Theme), 'Episode']) %>% summarise(pctThemes = percent(sum(Correct)/n())) 
totalTY <- dfOverallPerf %>% filter(Episode %in% dfEpisodeData[!is.na(dfEpisodeData$Theme), 'Episode']) %>% summarise(pctThemes = percent(sum(Correct)/n())) 
statTY <- rbind(statTY,c("ALL", totalTY[1,1])) %>% arrange(desc(pctThemes))

# All of this code is to pull from the Excel Summary for 2017
statName <- '% Wins with Themes'
statLY <- dfSGUSummary[, statName]
statLY <- na.exclude(statLY)
statLY2 <- sprintf("%.1f%%", statLY*100)
names(statLY2) <- names(statLY)
dfstatLY2 <- as.data.frame(statLY2)
dfstatLY2<- cbind(Panelist = rownames(dfstatLY2), dfstatLY2)
rownames(dfstatLY2) <- NULL


statYoY <- merge(statTY, dfstatLY2, by = 'Panelist') 

names(statYoY) <- c('Panelist', Current_Year, Last_Year)

kable(statYoY, format.args = list(justify='right', width=500) , rownames=TRUE,  digits=1, align = c('l', 'c', 'c'), format='html', table.attr = "style='width:25%;'")

#showStatistic_2(stat)
```

### Performance For Segments WITHOUT Themes
``` {r winswithoutThemes_debug, echo = FALSE, eval = debug_flag}
Win Percentage For Segments WITHOUT Themes
showStatistic('% Wins without Themes')
```

``` {r winswithoutThemes, echo = FALSE}
statTY <- dfPanelistPerf %>% group_by(Panelist) %>% filter(Episode %in% dfEpisodeData[is.na(dfEpisodeData$Theme), 'Episode']) %>% summarise(pctThemes = percent(sum(Correct)/n()))
totalTY <- dfOverallPerf %>% filter(Episode %in% dfEpisodeData[is.na(dfEpisodeData$Theme), 'Episode']) %>% summarise(pctThemes = percent(sum(Correct)/n())) 
statTY <- rbind(statTY,c("ALL", totalTY[1,1])) %>% arrange(desc(pctThemes))


# All of this code is to pull from the Excel Summary for 2017
statName <- '% Wins without Themes'
statLY <- dfSGUSummary[, statName]
statLY <- na.exclude(statLY)
statLY2 <- sprintf("%.1f%%", statLY*100)
names(statLY2) <- names(statLY)
dfstatLY2 <- as.data.frame(statLY2)
dfstatLY2<- cbind(Panelist = rownames(dfstatLY2), dfstatLY2)
rownames(dfstatLY2) <- NULL


statYoY <- merge(statTY, dfstatLY2, by = 'Panelist') 

names(statYoY) <- c('Panelist', Current_Year, Last_Year)

kable(statYoY, format.args = list(justify='right', width=500) , rownames=TRUE,  digits=1, align = c('l', 'c', 'c'), format='html', table.attr = "style='width:25%;'")

#showStatistic_2(stat)
```

### Solo Wins
``` {r SoloWins_debug, echo = FALSE, eval = debug_flag}
showStatistic('Solo Wins', ispercentage = FALSE)
```

``` {r SoloWins, echo = FALSE}
dfSoloWins <- dfItemsSelected[dfItemsSelected$Episode %in% dfEpisodeData[dfEpisodeData$CorrectAnswers==1, 'Episode'] & dfItemsSelected$Correct==1, c('Episode', 'Panelist')]
stat <- dfSoloWins %>% group_by(Panelist) %>% summarise(SoloWins = n()) %>% arrange(desc(SoloWins))
total <- dfSoloWins  %>% summarise(SoloWins = n()) 
stat <- rbind(stat,c("TOTAL", total[1,1])) 
showStatistic_2(stat)
```

### Longest Consecutive Winning Streak
``` {r WinStreak_debug, echo = FALSE, eval = debug_flag}
showStatistic('Longest Winning Streak', ispercentage = FALSE)
```

``` {r WinStreak, echo = FALSE}
wins = list()
losses = list()
for (rogue in Rogues) {
    df <- dfItemsSelected %>% filter(Panelist == rogue)
    x = rle(df$Correct)
    wins[rogue] = max(x$lengths[x$values == 1])
    losses[rogue] = max(x$lengths[x$values == 0])
}
wins <- wins[order(unlist(wins),decreasing=TRUE)]
wins <- wins[wins >= 0]
stat <- t(as.data.frame(wins))

showStatistic_2(stat)
```

### Longest Consecutive Losing Streak
``` {r LoseStreak_debug, echo = FALSE, eval = debug_flag}
showStatistic('Longest Losing Streak', ispercentage = FALSE)
```
``` {r LoseStreak, echo = FALSE}
losses <- losses[order(unlist(losses),decreasing=TRUE)]
losses <- losses[losses >= 0]
stat <- t(as.data.frame(losses))
showStatistic_2(stat)
```

### Panel Performance When Answering First
#### A measure of how well the panel of rogues perform based on who answers first

``` {r PanelPerformance_debug, echo = FALSE, eval = debug_flag}
showStatistic('Panel Performance When Answering First')
```
``` {r PanelPerformance, echo = FALSE}
statTY <- dfEpisodeData %>% filter(FirstPanelist %in% Rogues) %>% group_by(FirstPanelist) %>% summarise(PanelPerformance = percent(sum(CorrectAnswers)/sum(TotalPanelists))) %>% arrange(desc(PanelPerformance))
#showStatistic_2(statTY)

# All of this code is to pull from the Excel Summary for 2017
statName <- 'Panel Performance When Answering First'
statLY <- dfSGUSummary[, statName]
statLY <- na.exclude(statLY)
statLY2 <- sprintf("%.1f%%", statLY*100)
names(statLY2) <- names(statLY)
dfstatLY2 <- as.data.frame(statLY2)
dfstatLY2<- cbind(Panelist = rownames(dfstatLY2), dfstatLY2)
rownames(dfstatLY2) <- NULL
#showStatistic_2(statLY2)

names(statTY) <- c('Panelist', 'PanelPerformance')
statYoY <- merge(statTY, dfstatLY2, by = 'Panelist') 

names(statYoY) <- c('Panelist', Current_Year, Last_Year)

statYoY <- statYoY %>% arrange(desc(`2018`))
kable(statYoY, format.args = list(justify='right', width=500) , rownames=TRUE,  digits=1, align = c('l', 'c', 'c'), format='html', table.attr = "style='width:25%;'")
```

### Individual Panelist Performance When Answering First
#### A measure of an individuals performance when answering first
``` {r PanelistPerformance_debug, echo = FALSE, eval = debug_flag}
showStatistic('Panelist Performance When Answering First')
```
``` {r PanelistPerformance, echo = FALSE}
stat <- dfPanelistPerf %>% group_by(Panelist) %>% filter(AnsweringOrder==1) %>% summarise(pctAnsweringFirst = percent(sum(Correct)/n())) %>% arrange(desc(pctAnsweringFirst))
total <- dfOverallPerf %>% filter(AnsweringOrder==1) %>% summarise(pctAnsweringFirst = percent(sum(Correct)/n())) %>% arrange(desc(pctAnsweringFirst))
statTY <- rbind(stat,c("ALL", total[1,1])) %>% arrange(desc(pctAnsweringFirst))
#showStatistic_2(statTY)

# All of this code is to pull from the Excel Summary for 2017
statName <- 'Panelist Performance When Answering First'
statLY <- dfSGUSummary[, statName]
statLY <- na.exclude(statLY)
statLY2 <- sprintf("%.1f%%", statLY*100)
names(statLY2) <- names(statLY)
dfstatLY2 <- as.data.frame(statLY2)
dfstatLY2<- cbind(Panelist = rownames(dfstatLY2), dfstatLY2)
rownames(dfstatLY2) <- NULL
#showStatistic_2(statLY2)

names(statTY) <- c('Panelist', 'PanelPerformance')
statYoY <- merge(statTY, dfstatLY2, by = 'Panelist') 

names(statYoY) <- c('Panelist', Current_Year, Last_Year)

statYoY <- statYoY %>% arrange(desc(`2018`))
kable(statYoY, format.args = list(justify='right', width=500) , rownames=TRUE,  digits=1, align = c('l', 'c', 'c'), format='html', table.attr = "style='width:25%;'")
```

### Host Sweeps
``` {r HostSweeps_debug, echo = FALSE, eval = debug_flag}
showStatistic('Host Sweeps', ispercentage = FALSE)
```

``` {r HostSweeps, echo = FALSE}
dfHostSweeps <- dfEpisodeData[dfEpisodeData$CorrectAnswers==0, c('Episode', 'Host')]
stat <- dfHostSweeps %>% group_by(Host) %>% summarize(HostSweeps = n()) %>% arrange(desc(HostSweeps))
total <- dfHostSweeps %>% summarize(HostSweeps = n())
statTY <- rbind(stat,c("ALL", total[1,1])) 
#showStatistic_2(statTY)

# All of this code is to pull from the Excel Summary for 2017
statName <- 'Host Sweeps'
statLY <- dfSGUSummary[, statName]
statLY2 <- na.exclude(statLY)
#statLY2 <- sprintf("%.1f%%", statLY*100)
names(statLY2) <- names(statLY)
dfstatLY2 <- as.data.frame(statLY2)
dfstatLY2<- cbind(Panelist = rownames(dfstatLY2), dfstatLY2)
#print(dfstatLY2)
dfstatLY2 <- dfstatLY2 %>% filter(statLY2 > 0)
rownames(dfstatLY2) <- NULL

#showStatistic_2(statLY2)

names(statTY) <- c('Panelist', 'PanelPerformance')
statYoY <- merge(statTY, dfstatLY2, by = 'Panelist', all = TRUE) 

names(statYoY) <- c('Host', Current_Year, Last_Year)

statYoY <- statYoY %>% arrange(desc(`2018`))
kable(statYoY, format.args = list(justify='right', width=500) , rownames=TRUE,  digits=1, align = c('l', 'c', 'c'), format='html', table.attr = "style='width:25%;'")
```

### Panelist Sweeps
#### How many times a panelist has participated in a sweep of the host
``` {r PanelSweeps_debug, echo = FALSE, eval = debug_flag}
showStatistic('Panelist Sweeps', ispercentage = FALSE)
```

``` {r PanelSweeps, echo = FALSE}
statTY <- dfItemsSelected[dfItemsSelected$Episode %in% dfEpisodeData[dfEpisodeData$CorrectAnswers == dfEpisodeData$TotalPanelists,"Episode"],] %>% group_by(Panelist) %>% summarise(PanelistSweeps = n()) %>% filter(Panelist %in% Rogues) %>% arrange(desc(PanelistSweeps))
#showStatistic_2(statTY)

# All of this code is to pull from the Excel Summary for 2017
statName <- 'Panelist Sweeps'
statLY <- dfSGUSummary[, statName]
statLY2 <- na.exclude(statLY)
#statLY2 <- sprintf("%.1f%%", statLY*100)
names(statLY2) <- names(statLY)
dfstatLY2 <- as.data.frame(statLY2)
dfstatLY2<- cbind(Panelist = rownames(dfstatLY2), dfstatLY2)
rownames(dfstatLY2) <- NULL
#showStatistic_2(statLY2)

names(statTY) <- c('Panelist', 'PanelPerformance')
statYoY <- merge(statTY, dfstatLY2, by = 'Panelist') 

names(statYoY) <- c('Panelist', Current_Year, Last_Year)

statYoY <- statYoY %>% arrange(desc(`2018`))
kable(statYoY, format.args = list(justify='right', width=500) , rownames=TRUE,  digits=1, align = c('l', 'c', 'c'), format='html', table.attr = "style='width:25%;'")
```


``` {r DuoPerformance_1, echo = FALSE}
    dfDuoPerf <- inner_join(dfItemsSelected, dfItemsSelected, by='Episode')
    
    dfDuo <- dfDuoPerf %>% filter(Panelist.x %in% Rogues) %>% filter(Panelist.y %in% Rogues) %>% group_by(Panelist.x, Panelist.y, ItemSelected.x == ItemSelected.y) %>% summarise('Percent Correct' = percent(sum(Correct.x)/n()))
   
    dfDuo <-  rename(dfDuo, Rogue = Panelist.x) 
    dfDuo <-  rename(dfDuo, Peer = Panelist.y)
    dfDuo <-  rename(dfDuo, Agree = 'ItemSelected.x == ItemSelected.y')

    dfDuoWide <- dfDuo %>% filter(Agree==FALSE) %>% dcast( Rogue ~ Peer , value.var ='Percent Correct')
    
    pctCaraBob <- dfDuo %>% filter(Rogue == 'Cara' & Peer =='Bob' & Agree == FALSE) 
    pctBobCara <- dfDuo %>% filter(Rogue == 'Bob' & Peer =='Cara' & Agree == FALSE) 

```

### Duo Performance
#### How well each pair of rouges performs when choosing a DIFFERENT answer from their peer
For example, when Cara answers differently from Bob, she is correct `r pctCaraBob['Percent Correct']` of the time.  
When Bob answers differently from Cara, he is correct `r pctBobCara['Percent Correct']` of the time.

``` {r DuoPerformance_2, echo = FALSE}
    kable(dfDuoWide, format.args = list(justify='right', width=500) , rownames=TRUE, digits=1, align = c('l', 'c', 'c','c','c','c'), format='html', table.attr = "style='width:35%;'")

    dfDuoWide <- dfDuo %>% filter(Agree==TRUE) %>% dcast( Rogue ~ Peer , value.var ='Percent Correct')
    
    pctJayEvan <- dfDuo %>% filter(Rogue == 'Jay' & Peer =='Evan' & Agree == TRUE) 
```

#### How well each pair of rouges performs when choosing the SAME answer as their peer
For example, when Jay and Evan pick the same answer they are correct `r pctJayEvan['Percent Correct']` of the time.  
Note: Numbers along the diagonal are the same as individual performance for the year.  

``` {r DuoPerformance_3, echo = FALSE}
    kable(dfDuoWide, format.args = list(justify='right', width=500) , rownames=TRUE, digits=1, align = c('l', 'c', 'c','c','c','c'), format='html', table.attr = "style='width:35%;'")
```

